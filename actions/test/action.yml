name: Test action
description: Test action

inputs:
  jira_server:
    description: Jira server
    required: true
  jira_username:
    description: Jira username
    required: true
  jira_token:
    description: Jira token
    required: true
  summary:
    description: Jira Ticket Summary
    required: true
  description:
    description: Jira Ticket Description
    required: true
  project:
    description: Jira Project
    required: true
  type:
    description: Jira Ticket Type
    required: true
  actions_hub_dir:
    description: Actions Hub checkout directory
    default: "./.github/actions-hub"
    required: false

outputs:
  link:
    description: The Jira Ticket link
    value: ${{ steps.create-ticket.outputs.link }}

runs:
  using: "composite"
  steps:
    - id: requirements
      shell: bash
      run: echo "path=${{ inputs.actions_hub_dir }}/scripts/python/requirements.txt" >> "${GITHUB_OUTPUT}"

    - shell: bash
      run: echo "${{ steps.requirements.outputs.path }}"

    - uses: actions/cache@v3
      name: Configure pip cache
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-gh-actions-${{ hashFiles(steps.requirements.outputs.path) }}

    - name: Install tools and dependencies
      shell: bash
      working-directory: ${{ inputs.actions_hub_dir }}
      run: pip install -r scripts/python/requirements.txt

    - name: Create Jira Ticket
      id: create-ticket
      shell: bash
      working-directory: ${{ inputs.actions_hub_dir }}
      env:
        JIRA_SERVER: ${{ inputs.jira_server }}
        JIRA_USERNAME: ${{ inputs.jira_username }}
        JIRA_TOKEN: ${{ inputs.jira_token }}
        JIRA_TICKET_SUMMARY: ${{ inputs.summary }}
        JIRA_TICKET_DESCRIPTION: ${{ inputs.description }}
        JIRA_PROJECT: ${{ inputs.project }}
        JIRA_TICKET_TYPE: ${{ inputs.type }}
        WORKFLOW_RUN_LINK: "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
      run: python 'scripts/python/create_jira_issue.py'
